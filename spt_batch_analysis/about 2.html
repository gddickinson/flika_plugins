<!DOCTYPE html>
<html>
<head>
    <title>SPT Batch Analysis Plugin</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            line-height: 1.6;
            color: #333;
        }
        h1 { color: #2E86AB; }
        h2 { color: #A23B72; }
        h3 { color: #F18F01; }
        .version { color: #666; font-style: italic; }
        .author { margin-top: 10px; }
        code {
            background-color: #f4f4f4;
            padding: 2px 4px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }
        .section-box {
            background-color: #f9f9f9;
            padding: 15px;
            border-left: 4px solid #2E86AB;
            margin: 15px 0;
        }
        .feature-box {
            background-color: #e8f5e8;
            padding: 10px;
            margin: 8px 0;
            border-left: 3px solid #4CAF50;
        }
        .workflow-step {
            background-color: #fff8e1;
            padding: 10px;
            margin: 8px 0;
            border-left: 3px solid #F18F01;
        }
        .parameter-table {
            border-collapse: collapse;
            width: 100%;
            margin: 15px 0;
        }
        .parameter-table th, .parameter-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        .parameter-table th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
        .output-table {
            border-collapse: collapse;
            width: 100%;
            margin: 15px 0;
        }
        .output-table th, .output-table td {
            border: 1px solid #ddd;
            padding: 6px;
            text-align: left;
            font-size: 0.9em;
        }
        .output-table th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
        .code-block {
            background-color: #f8f8f8;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            margin: 10px 0;
        }
        .tab-description {
            background-color: #e3f2fd;
            padding: 10px;
            margin: 5px 0;
            border-left: 3px solid #2196F3;
        }
    </style>
</head>
<body>
    <h1>SPT Batch Analysis Plugin</h1>
    <p class="version">Version 2.0</p>
    <p class="author">For FLIKA - A Python-based image analysis platform</p>

    <h2>Description</h2>
    <p>
        The SPT (Single Particle Tracking) Batch Analysis plugin provides comprehensive automated analysis
        of single particle tracking data from fluorescence microscopy images. The plugin integrates particle
        detection, linking, feature calculation, and advanced analysis methods into a unified workflow designed
        for batch processing of multiple experimental datasets.
    </p>

    <div class="section-box">
        <h3>Core Capabilities</h3>
        <ul>
            <li><strong>Particle Detection:</strong> U-Track based detection with background estimation and statistical significance testing</li>
            <li><strong>Particle Linking:</strong> Multiple algorithms including built-in method, trackpy integration, and U-Track with mixed motion models</li>
            <li><strong>Feature Analysis:</strong> Over 45 quantitative features including geometric, kinetic, and spatial parameters</li>
            <li><strong>Advanced Analysis:</strong> Machine learning classification, autocorrelation analysis, and geometric methods</li>
            <li><strong>Batch Processing:</strong> Automated processing of multiple files with error handling and progress tracking</li>
        </ul>
    </div>

    <h2>Plugin Interface</h2>
    <p>Access through: <strong>Plugins → SPT Batch Analysis → Launch SPT Analysis</strong></p>

    <h3>Tab Organization</h3>

    <div class="tab-description">
        <strong>Files Tab:</strong> Select input directory and file patterns for batch processing. Supports recursive directory searching and experiment name auto-detection from folder structure.
    </div>

    <div class="tab-description">
        <strong>Detection Tab:</strong> Configure U-Track particle detection parameters including PSF sigma, significance thresholds, and output options. Detection runs automatically when enabled.
    </div>

    <div class="tab-description">
        <strong>Parameters Tab:</strong> Choose particle linking method and configure parameters. Options include built-in linking, trackpy integration, or U-Track with mixed motion models (PMMS algorithm).
    </div>

    <div class="tab-description">
        <strong>Analysis Steps Tab:</strong> Enable/disable specific analysis components including nearest neighbor analysis, velocity calculations, SVM classification, and background subtraction.
    </div>

    <div class="tab-description">
        <strong>Geometric Analysis Tab:</strong> Configure alternative geometric analysis methods including simple Rg calculations, scaled Rg metrics, and linear motion classification.
    </div>

    <div class="tab-description">
        <strong>Autocorrelation Tab:</strong> Set up directional autocorrelation analysis parameters and visualization options. Includes live analysis tools for loaded track data.
    </div>

    <div class="tab-description">
        <strong>Export Control Tab:</strong> Select which columns to include in output files, configure multiple export formats, and enable metadata export.
    </div>

    <div class="tab-description">
        <strong>Progress Tab:</strong> Monitor analysis progress with real-time logging and status updates during batch processing.
    </div>

    <h2>Analysis Pipeline</h2>

    <div class="workflow-step">
        <strong>Phase 1: Detection and Main Analysis</strong><br>
        For each selected file: particle detection (if enabled) → particle linking → feature calculation → specialized analyses → data export
    </div>

    <div class="workflow-step">
        <strong>Phase 2: Autocorrelation Analysis</strong><br>
        For successfully processed files: load track data → calculate directional persistence → generate plots → export results
    </div>

    <h3>Particle Linking Methods</h3>

    <table class="parameter-table">
        <tr>
            <th>Method</th>
            <th>Description</th>
            <th>Best For</th>
            <th>Key Parameters</th>
        </tr>
        <tr>
            <td>Built-in</td>
            <td>Fast linking algorithm with gap closing</td>
            <td>Sparse particles, simple motion</td>
            <td>Max distance, max gap frames</td>
        </tr>
        <tr>
            <td>Trackpy</td>
            <td>Python implementation of Crocker & Grier algorithm</td>
            <td>Dense particles, adaptive search</td>
            <td>Search distance, memory, linking type</td>
        </tr>
        <tr>
            <td>U-Track Mixed Motion</td>
            <td>LAP-based with heterogeneous motion support</td>
            <td>Complex motion patterns, regime switching</td>
            <td>Motion model, regime sensitivity, transition probabilities</td>
        </tr>
    </table>

    <h2>Analysis Features</h2>

    <h3>Core Track Features</h3>
    <div class="feature-box">
        <strong>Geometric Properties:</strong> Radius of gyration, asymmetry, skewness, kurtosis, fractal dimension, net displacement, efficiency, straightness measurements
    </div>

    <div class="feature-box">
        <strong>Kinematic Analysis:</strong> Lag displacements, velocities, track lengths, directional persistence, mean squared displacement
    </div>

    <div class="feature-box">
        <strong>Spatial Analysis:</strong> Nearest neighbor distances and counts at multiple radii, local density measurements, frame-by-frame spatial statistics
    </div>

    <h3>Advanced Analysis Methods</h3>

    <div class="feature-box">
        <strong>Geometric Analysis Suite:</strong> Alternative radius of gyration calculations using direct geometric methods, scaled Rg metrics for mobility classification, linear motion detection with directionality ratios
    </div>

    <div class="feature-box">
        <strong>Machine Learning Classification:</strong> SVM-based particle mobility classification (mobile/confined/trapped) with Box-Cox preprocessing and hyperparameter optimization
    </div>

    <div class="feature-box">
        <strong>Autocorrelation Analysis:</strong> Directional persistence measurements following Gorelik & Gautreau methodology, autocorrelation decay curves with statistical analysis
    </div>

    <div class="feature-box">
        <strong>Background Correction:</strong> ROI-based background subtraction with frame-specific or average correction, camera black level estimation
    </div>

    <div class="feature-box">
        <strong>Data Enhancement:</strong> Missing points integration with intensity calculation, enhanced interpolation for trapped particles, unlinked localization recovery
    </div>

    <h2>Detection Parameters</h2>

    <table class="parameter-table">
        <tr>
            <th>Parameter</th>
            <th>Description</th>
            <th>Default</th>
            <th>Range</th>
        </tr>
        <tr>
            <td>PSF Sigma</td>
            <td>Expected point spread function width</td>
            <td>1.5 pixels</td>
            <td>0.5-10.0</td>
        </tr>
        <tr>
            <td>Alpha Threshold</td>
            <td>Statistical significance for detection</td>
            <td>0.05</td>
            <td>0.001-0.5</td>
        </tr>
        <tr>
            <td>Minimum Intensity</td>
            <td>Absolute intensity cutoff</td>
            <td>100.0</td>
            <td>0-10000</td>
        </tr>
    </table>

    <h2>Output Files</h2>

    <table class="output-table">
        <tr>
            <th>File Type</th>
            <th>Suffix</th>
            <th>Content</th>
            <th>Purpose</th>
        </tr>
        <tr>
            <td>Detection Results</td>
            <td><code>_locsID.csv</code></td>
            <td>frame, x [nm], y [nm], intensity [photon], id</td>
            <td>Particle localizations from U-Track detection</td>
        </tr>
        <tr>
            <td>Basic Tracks</td>
            <td><code>_tracks.csv</code></td>
            <td>Essential tracking data with experiment info</td>
            <td>Core trajectory information</td>
        </tr>
        <tr>
            <td>Features Only</td>
            <td><code>_features.csv</code></td>
            <td>Core and geometric features</td>
            <td>Analysis features without raw positions</td>
        </tr>
        <tr>
            <td>Complete Analysis</td>
            <td><code>_enhanced_analysis.csv</code></td>
            <td>All calculated features and metadata</td>
            <td>Comprehensive results for further analysis</td>
        </tr>
        <tr>
            <td>Autocorrelation Data</td>
            <td><code>_autocorr_*.csv</code></td>
            <td>Average curves and individual track data</td>
            <td>Directional persistence analysis results</td>
        </tr>
        <tr>
            <td>Autocorrelation Plot</td>
            <td><code>_autocorr_plot.png</code></td>
            <td>Publication-ready visualization</td>
            <td>Decay curves with error bars and statistics</td>
        </tr>
        <tr>
            <td>Analysis Metadata</td>
            <td><code>_analysis_metadata.json</code></td>
            <td>Complete parameter set and column information</td>
            <td>Analysis reproducibility and documentation</td>
        </tr>
    </table>

    <h2>Usage Workflow</h2>

    <div class="workflow-step">
        <strong>1. File Setup:</strong> Organize TIFF files in directories. Place ROI files (for background subtraction) and localization CSV files (if using pre-detected particles) in the same directories.
    </div>

    <div class="workflow-step">
        <strong>2. Configuration:</strong>
        <ul>
            <li>Select input directory and file pattern</li>
            <li>Enable detection if working with raw images</li>
            <li>Choose linking method and configure parameters</li>
            <li>Select desired analysis components</li>
            <li>Configure output options</li>
        </ul>
    </div>

    <div class="workflow-step">
        <strong>3. Analysis Execution:</strong> Click "Start Analysis" to begin automated processing. Monitor progress in the Progress tab with real-time st
