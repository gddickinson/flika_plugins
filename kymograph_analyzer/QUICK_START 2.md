# Quick Start: Kymograph Analyzer for PIEZO1 Ca¬≤‚Å∫ Flickers

## For the Pathak Lab @ UCI

This plugin is specifically designed for analyzing localized Ca¬≤‚Å∫ flickers generated by PIEZO1 channels in your TIRF microscopy experiments!

## Installation

1. Copy the `kymograph_analyzer` folder to your FLIKA plugins directory
2. Restart FLIKA
3. Find it under: **Plugins ‚Üí Kymograph Analyzer**

## 30-Second Workflow

### Analyzing Ca¬≤‚Å∫ Flickers

1. **Open your TIRF Ca¬≤‚Å∫ movie** in FLIKA (must be time-lapse 3D stack)

2. **Launch plugin**: `Plugins ‚Üí Kymograph Analyzer`

3. **Draw ROI**:
   - Click "Draw Line ROI"
   - Draw line along plasma membrane where you see flickers
   - Recommended width: **5-10 pixels**

4. **Generate Kymograph**:
   - Set Line Width: **7**
   - Normalize: **‚úì ON**
   - Detrend: **‚úì ON** (if baseline drifts)
   - Gaussian Smoothing: **1.0**
   - Click **"Generate Kymograph"**

5. **Detect Flickers**:
   - Detection Method: **peaks**
   - Threshold: **2.5** (STD)
   - Min Distance: **3** frames
   - Min Duration: **2** frames
   - Click **"Detect Events"**

6. **Analyze & Visualize**:
   - Click **"Full Analysis & Plot"**
   - View detected flickers, spatial distribution, statistics

7. **Export**:
   - Click **"Export Data"**
   - Saves kymograph, event table, statistics

## What You'll See

**In the Kymograph:**
- **Vertical axis** = Time (frames going down)
- **Horizontal axis** = Position along your ROI
- **Bright spots** = Ca¬≤‚Å∫ flickers!
- **Vertical lines** = Stationary flicker sources
- **Diagonal lines** = Propagating Ca¬≤‚Å∫ waves

## Key Measurements for Your Papers

The plugin automatically quantifies:

‚úì **Flicker Frequency** - How many events per unit length  
‚úì **Flicker Amplitude** - Peak ŒîF/F‚ÇÄ  
‚úì **Flicker Duration** - How long each lasts  
‚úì **Spatial Distribution** - Where along membrane they occur  
‚úì **Temporal Properties** - Rise time, decay time  
‚úì **Clustering** - Are flickers spatially clustered?  

## Typical Parameters for Your Experiments

Based on your published work (Ellefsen et al. 2019):

| Parameter | Value | Rationale |
|-----------|-------|-----------|
| **Frame Rate** | ‚â•20 Hz | Ca¬≤‚Å∫ flickers are fast (~100-500 ms) |
| **Line Width** | 5-10 px | Captures membrane thickness |
| **Detection Threshold** | 2.0-3.0 STD | Balances sensitivity vs false positives |
| **Min Duration** | 2-3 frames | Distinguishes flickers from noise |
| **Smoothing** | 0.5-1.5 sigma | Reduces noise, preserves features |

## Example Use Cases

### 1. Compare PIEZO1 Activity ¬± Treatment

```
1. Acquire TIRF of control cells
2. Generate kymographs for multiple cells
3. Count flickers per ¬µm per second
4. Repeat for treated cells
5. Compare flicker frequency/amplitude
```

### 2. Spatial Distribution of Flickers

```
1. Draw line across entire cell membrane
2. Generate wide kymograph
3. Detect all events
4. Plot event positions (from export data)
5. Test for clustering vs uniform distribution
```

### 3. Flicker Properties vs Matrix Stiffness

```
1. Culture cells on different stiffness substrates
2. For each condition, analyze ‚â•10 cells
3. Measure flicker amplitude and frequency
4. Compare across conditions
5. Correlate with matrix mechanics
```

### 4. Traction Force-Flicker Relationships

```
1. Combine with traction force microscopy
2. Generate kymograph along high-force regions
3. Compare flicker frequency in high vs low force areas
4. Quantify spatial correlation
```

## Pro Tips

üí° **Multiple ROIs**: Draw several lines per cell to sample different regions  
üí° **Time Averaging**: Use spatial profile plot to find hotspots  
üí° **Quality Control**: Visually inspect detected events (false positives?)  
üí° **Batch Analysis**: Use Python API to process many cells at once  
üí° **Combine with Tracking**: Use detected flicker locations for ROI analysis  

## Keyboard Shortcuts

While viewing kymograph:
- **Scroll wheel**: Zoom in/out
- **Click + Drag**: Pan around
- **Right-click**: Context menu with options

## Exporting for Papers

The plugin exports:
1. **Kymograph array** (.npy) - For reanalysis
2. **Event table** (.csv) - All detected events with properties
3. **Statistics** (.csv) - Summary stats
4. **Plots** (from matplotlib) - Publication-quality figures

Save matplotlib figures as:
- **.pdf** for vector graphics (best for papers!)
- **.png** for presentations (300 DPI recommended)

## Troubleshooting

| Problem | Solution |
|---------|----------|
| No flickers detected | Lower threshold to 1.5-2.0 |
| Too many false positives | Increase threshold to 3.0+, increase min_duration |
| Kymograph too noisy | Increase smoothing, increase line width |
| Events look smeared | Reduce temporal binning, reduce smoothing |
| Baseline drift | Enable detrending |

## Common Mistakes to Avoid

‚ùå **Drawing ROI off the membrane** ‚Üí Won't capture flickers  
‚ùå **Line too narrow** (1-2 px) ‚Üí Too noisy  
‚ùå **Line too wide** (>20 px) ‚Üí Includes cytoplasm, reduces spatial resolution  
‚ùå **Threshold too low** ‚Üí Many false positives  
‚ùå **Not enough cells analyzed** ‚Üí Need ‚â•10-20 for statistics  
‚ùå **Forgetting to normalize** ‚Üí Can't compare across cells/conditions  

## Integration with Your Workflow

**Before Kymograph:**
- Drift correction (if needed)
- Bleach correction (if long time-lapse)

**After Kymograph:**
- ROI analysis at flicker locations
- Correlation with PIEZO1-GFP localization
- Tracking studies
- Statistical testing

## Python API Example

For batch processing multiple cells:

```python
from plugins.kymograph_analyzer import kymograph_analyzer

# Standard parameters for your lab
params = {
    'width': 7,
    'normalize': True,
    'detrend': True,
    'gaussian_sigma': 1.0
}

# Process all cells
for i, cell_window in enumerate(my_cells):
    # Generate kymograph
    kymo = kymograph_analyzer(cell_window, **params)
    
    # Detect flickers
    events = kymograph_analyzer.detect_events(
        method='peaks',
        threshold=2.5,
        min_distance=3,
        min_duration=2
    )
    
    # Export
    kymograph_analyzer.export_data(f"cell_{i}_flickers")
    
    print(f"Cell {i}: {len(events)} flickers detected")
```

## Relevant Papers

Your lab's work this tool is designed for:

1. **Ellefsen et al. (2019)** - *Comm Biol*  
   "Myosin-II mediated traction forces evoke localized Piezo1 Ca¬≤‚Å∫ flickers"

2. **Pathak et al. (2014)** - *PNAS*  
   "Stretch-activated ion channel Piezo1 directs lineage choice in human neural stem cells"

3. **Nourse & Pathak (2017)** - *Semin Cell Dev Biol*  
   "How cells channel their stress: Interplay between Piezo1 and the cytoskeleton"

## Getting Help

- **Full Documentation**: See README.md in plugin folder
- **FLIKA Help**: https://flika-org.github.io/
- **Lab Meetings**: Demo and discuss!

---

**Made with ‚ù§Ô∏è for the Pathak Lab's groundbreaking PIEZO1 research!**

Questions? Bugs? Feature requests? Let us know!

üî¨ **Happy flicker hunting!** ‚ö°‚ú®
