# -*- coding: utf-8 -*-
"""
Created on Sun Feb 23 12:46:32 2020

@author: George
"""
import os,sys
try:
    from BioDocks import *
except:
    from .BioDocks import *
from pyqtgraph.dockarea import *
from scipy.spatial import ConvexHull
from collections import OrderedDict
from PyQt5.QtCore import pyqtSignal, pyqtSlot
from qtpy import QtWidgets, QtCore, QtGui
from qtpy.QtGui import *
from qtpy.QtWidgets import *
from qtpy.QtCore import *
import flika
from flika import global_vars as g
from flika.window import Window
from distutils.version import StrictVersion
import numpy as np
import pyqtgraph as pg
from pyqtgraph import mkPen
from matplotlib import pyplot as plt
import copy
import pandas as pd
from sklearn.neighbors import KDTree
import random
import time
from mpl_toolkits.mplot3d import Axes3D # <--- This is needed for newer versions of matplotlib



flika_ch1=np.array([
[ 28849.801,  28046.604,    -69.577],
[ 27766.59,   27610.517,   -140.14 ],
[ 28191.031,  29548.444,    -37.048],
[ 27285.888,  30138.903,    -46.435],
[ 27545.076,  29030.776,   -133.687],
[ 34489.221,  25583.399,    -84.541],
[ 32475.941,  26758.759,    -80.956],
[ 33386.625,  27659.698,      2.476],
[ 31271.405,  28160.945,    -67.217],
[ 31558.25,   29113.995,    -52.919],
[ 28721.319,  29385.331,     -5.442],
[ 32934.606,  26396.176,    -72.529],
[ 29167.9,    28558.128,   -107.619],
[ 36937.738,  24633.898,    -77.78 ],
[ 30671.771,  24698.787,   -124.09 ],
[ 33855.623,  24844.174,    -55.33 ],
[ 26153.912,  24597.138,   -134.657],
[ 31803.411,  30098.301,    -75.315],
[ 33362.993,  23370.046,   -111.79 ],
[ 36192.31,   26042.785,     95.725],
[ 33263.975,  29369.342,    -44.615],
[ 36559.777,  28737.011,    -19.001],
[ 31935.77,   31216.172,    101.554],
[ 32578.314,  25259.607,   -197.62 ],
[ 32498.104,  29079.978,    -87.256],
[ 35153.584,  25662.426,   -128.142],
[ 26500.6,    31140.9,        5.792],
[ 36192.923,  26040.988,    100.642]])

flika_ch2=np.array([
[ 28837.562,  28023.018,     31.606],
[ 27797.904,  27612.064,   -101.271],
[ 28181.748,  29531.938,    -45.415],
[ 27204.195,  30155.179,    -35.544],
[ 27559.117,  29052.583,    -79.524],
[ 34511.506,  25559.09,    -104.659],
[ 32481.97,  26710.734,    -17.592],
[ 33378.39,   27637.781,    116.19 ],
[ 31296.811,  28197.728,    -38.894],
[ 31565.558,  29123.4,      -53.131],
[ 28679.085,  29386.998,     86.17 ],
[ 32981.491,  26404.085,    -67.109],
[ 29150.344,  28635.35,    -121.757],
[ 36969.166,  24622.003,    -60.854],
[ 30674.546,  24670.4,      -31.949],
[ 33852.333,  24835.737,      8.277],
[ 26155.332,  24577.131,   -110.686],
[ 31823.54 ,  30033.058,   -128.855],
[ 33361.005,  23392.089,    -58.206],
[ 36194.087,  26045.045,     19.083],
[ 33283.499,  29321.428,    -89.694],
[ 36619.67,   28774.642,    -13.32 ],
[ 31906.728,  31234.607,     53.789],
[ 32522.525,  25211.325,     -2.005],
[ 32503.126,  29007.397,    -89.459],
[ 35163.128,  25672.141,    -78.937],
[ 26494.654,  31062.431,    168.638],
[ 36193.515,  26044.323,     19.535]])
     
cluster_ch1 = np.array([   
[ 34526.88139535,  25538.42325581,   -126.44806302],
[ 28166.35714286,  29535.05357143,    -38.58757143],
[ 33299.0038961,   29306.39090909 ,  -132.08179091],
[ 26224.8,    24571.6,     -175.479],
[  2.78417000e+04,   2.75756000e+04,   1.43412000e+00],
[ 32460.17142857,  26718.46938776 ,    80.12466592],
[ 36960.2775,   24593.43  ,     -55.22301],
[ 33839.3,         24814.24042553 ,    96.5993234 ],
[ 35162.44590164,  25689.78360656  ,  -94.9104918 ],
[ 30665.72063492,  24646.00952381   ,  34.33798   ],
[ 32497.31304348 , 28991.95434783,    -75.98091957],
[ 33027.2,         26422.7137931 ,    -81.57070483],
[ 31582.44489796,  29144.01632653 ,   -72.25882449],
[  3.33716895e+04,   2.34078000e+04,  -5.43571053e-01],
[ 31845.33636364,  29963.07090909,   -182.66709455],
[ 31310.39692308,  28232.13538462 ,   -32.07337831],
[ 27566.8902439,   29046.08536585  ,  -53.6457861 ],
[  3.66411967e+04,   2.87816333e+04 , -1.03600867e+01],
[  2.71740600e+04,   3.01200600e+04 , -2.35087860e+01],
[ 28659.03055556,  29380.87222222,     96.86972407],
[ 36189.61944444,  26026.44444444 ,   -73.71611778],
[  3.18889037e+04,   3.12127407e+04,  -3.06474815e+01]])

cluster_ch2 = np.array([    
[ 34445.45853659,  25588.17317073 ,   -88.45559024],
[  2.81977125e+04,   2.95337719e+04,  -2.59551326e+01],
[  3.32529778e+04 ,  2.94278926e+04,   2.69828185e+01],
[ 26149.13218391,  24608.57931034 ,  -146.33821425],
[ 27763.44785714,  27623.61357143 ,  -140.95394343],
[ 32478.1627907 ,  26776.7255814 ,   -128.81944186],
[ 36933.78977273,  24650.13863636 ,   -69.16387432],
[ 33881.37017544 , 24847.16315789,    -76.79141404],
[ 35081.33913043, 25642.84782609 ,  -118.56413478],
[ 30674.95471698 , 24719.09056604 ,  -161.85050377],
[ 32504.95  ,      29116.64705882 ,  -100.90487529],
[ 32931.04761905 , 26388.02063492 ,   -80.97265476],
[ 31563.01111111 , 29131.53333333,    -62.76934815],
[ 33394.18488372,  23372.70813953 ,  -133.19176442],
[ 31783.89315068,  30116.14931507 ,   -62.37087534],
[ 31249.53529412,  28160.71568627 ,   -84.47394902],
[ 27546.53548387,  29038.7     ,     -139.1431    ],
[  3.65453042e+04,   2.87337813e+04 , -9.96111875e+00],
[ 27271.71333333 , 30146.04111111 ,   -63.78222378],
[ 28676.0125   ,   29423.45416667 ,    33.88152167],
[ 36185.85892857,  26028.75178571 ,   107.38298571],
[ 29200.31442308,  28501.6375   ,    -142.79400817],
[ 31924.87402597,  31240.91298701,    104.68693481]])
        
         
    
    
#3D viewer dock
app = QtWidgets.QApplication([])
        
win = DockWindow(addMenu=False)
win.resize(1700, 900)
win.setWindowTitle('Main Window')
viewerFrame = QtWidgets.QWidget()
layout = QtWidgets.QGridLayout(viewerFrame)
viewerWidget = Plot3DWidget()       
layout.addWidget(viewerWidget, 0, 0, 6, 6)
viewerDock = win.addWidget(size=(300, 100), widget=viewerFrame)
win.show()

viewerWidget.addArray(flika_ch1,color=QColor(0, 255, 0),size=4,name='flika_ch1')
viewerWidget.addArray(flika_ch2,color=QColor(255, 0, 0),size=4,name='flika_ch2')

viewerWidget.addArray(cluster_ch2,color=QColor(0, 255, 0),size=10,name='cluster_ch1')
viewerWidget.addArray(cluster_ch1,color=QColor(255, 0, 0),size=10,name='cluster_ch2')